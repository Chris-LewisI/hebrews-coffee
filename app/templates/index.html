<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HeBrews Coffee Cart</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .pending-orders {
        border: 2px solid green;
        padding: 1rem;
        margin-top: 1.5rem;
        border-radius: 0.5rem;
        background-color: #e6ffe6; /* light green background */
    }
    .pending-orders .list-group-item {
        font-size: 1.2rem;          /* larger font */
        font-weight: 600;           /* semi-bold */
        padding: 1rem 1.5rem;       /* more padding */
        background-color: #ccffcc;  /* slightly darker green for items */
        border-radius: 0.4rem;
        margin-bottom: 0.5rem;
        color: #005500;             /* dark green text for good contrast */
    }
    .completed-orders {
        border: 2px solid orange;
        padding: 1rem;
        margin-top: 1.5rem;
        border-radius: 0.5rem;
    }
  </style>

</head>
<body class="p-4">
  <h1>HeBrews Coffee Cart</h1>

  <form action="{{ url_for('order') }}" method="post" class="mb-4">
    <div class="row g-2 align-items-end">

      <div class="col-md-3">
        <label for="customer_name" class="form-label">Customer Name</label>
        <input type="text" name="customer_name" id="customer_name" class="form-control" placeholder="Enter your name" required>
      </div>

      <div class="col-md-3">
        <label for="drink" class="form-label">Drink</label>
        <select name="drink" id="drink" class="form-select" required>
          <option value="">Select a drink</option>
          <option value="Latte">Latte ($4)</option>
          <option value="Coffee">Coffee ($3)</option>
        </select>
      </div>

      <div class="col-md-2">
        <label for="size" class="form-label">Size</label>
        <select name="size" id="size" class="form-select" required>
          <option>Small</option>
          <option>Medium</option>
          <option>Large</option>
        </select>
      </div>

      <div class="col-md-2">
        <label for="milk" class="form-label">Milk</label>
        <select name="milk" id="milk" class="form-select" required>
          <option>Whole</option>
          <option>Oat</option>
          <option>Soy</option>
          <option>Almond</option>
          <option>None</option>
        </select>
      </div>

      <div class="col-md-2">
        <label for="temperature" class="form-label">Temperature</label>
        <select name="temperature" id="temperature" class="form-select" required>
          <option value="Hot">Hot</option>
          <option value="Iced">Iced</option>
        </select>
      </div>

      <div class="col-md-2 d-flex align-items-center">
        <div class="form-check mt-4">
          <input class="form-check-input" type="checkbox" id="extra_shot" name="extra_shot" value="true">
          <label class="form-check-label" for="extra_shot">
            Extra Shot (+$1)
          </label>
        </div>
      </div>

      <div class="col-md-12 mt-3">
        <label for="notes" class="form-label">Notes</label>
        <input type="text" name="notes" id="notes" class="form-control" placeholder="Extra hot, no foam, etc.">
      </div>

    </div>

    <div class="mt-3">
      <button class="btn btn-primary" type="submit">Place Order</button>
    </div>
  </form>

  <div class="pending-orders">
    <h3>In Progress Orders</h3>
    {% set in_progress = orders | selectattr('status', '!=', 'completed') | list %}
    {% if in_progress %}
      <ul class="list-group">
        {% for order in in_progress %}
          <li class="list-group-item d-flex justify-content-between align-items-center">

            <div>
              <strong>{{ order.customer_name }}'s {{ order.drink }}</strong> ({{ order.size }}, {{ order.milk }}, {{ order.temperature }})
              {% if order.extra_shot %}
                <br><small class="text-muted">+ Extra Shot</small>
              {% endif %}
              {% if order.notes %}
                <br><small class="text-muted">Note: {{ order.notes }}</small>
              {% endif %}
              <br><small class="fw-bold">Price: ${{ "%.2f"|format(order.price) }}</small>
            </div>

            <div class="d-flex gap-2">
              <form action="{{ url_for('update_status', order_id=order.id, status='completed') }}" method="post" style="margin: 0;">
                <button class="btn btn-success btn-sm">Mark Completed</button>
              </form>
              <form action="{{ url_for('delete_order', order_id=order.id) }}" method="post" style="margin: 0;">
                <button class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this order?')">Delete</button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No orders in progress.</p>
    {% endif %}
  </div>

  <div class="completed-orders">
    <h3>Completed Orders</h3>
    {% set completed = orders | selectattr('status', 'equalto', 'completed') | list %}
    {% if completed %}
      <ul class="list-group">
        {% for order in completed %}
          <li class="list-group-item d-flex justify-content-between align-items-center">

            <div>
              <strong>{{ order.customer_name }}'s {{ order.drink }}</strong> ({{ order.size }}, {{ order.milk }}, {{ order.temperature }})
              {% if order.extra_shot %}
                <br><small class="text-muted">+ Extra Shot</small>
              {% endif %}
              {% if order.notes %}
                <br><small class="text-muted">Note: {{ order.notes }}</small>
              {% endif %}
              <br><small class="fw-bold">Price: ${{ "%.2f"|format(order.price) }}</small>
            </div>

            <div class="d-flex gap-2">
              <form action="{{ url_for('update_status', order_id=order.id, status='pending') }}" method="post" style="margin: 0;">
                <button class="btn btn-warning btn-sm">Mark In Progress</button>
              </form>
              <form action="{{ url_for('delete_order', order_id=order.id) }}" method="post" style="margin: 0;">
                <button class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this order?')">Delete</button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No completed orders yet.</p>
    {% endif %}
  </div>

  <div class="summary">
    <h4>Summary</h4>
    {% set completed = orders | selectattr('status', 'equalto', 'completed') | list %}
    {% set total_drinks = completed | length %}
    {% set total_lattes = completed | selectattr('drink', 'equalto', 'Latte') | list | length %}
    {% set total_coffees = completed | selectattr('drink', 'equalto', 'Coffee') | list | length %}
    {% set total_money = completed | sum(attribute='price') %}
    <ul>
        <li><strong>Total Drinks Made:</strong> {{ total_drinks }}</li>
        <li><strong>Total Lattes:</strong> {{ total_lattes }}</li>
        <li><strong>Total Coffees:</strong> {{ total_coffees }}</li>
        <li><strong>Total Money Made:</strong> ${{ "%.2f"|format(total_money) }}</li>
    </ul>
  </div>
</body>
</html>
