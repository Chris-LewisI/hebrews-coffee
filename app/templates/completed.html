<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Completed Orders - HeBrews Coffee Cart</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="p-4">
  <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4 rounded">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('index') }}">
        <!-- Replace below text with an <img> tag if you have a logo image -->
        <strong>HeBrews</strong>
      </a>
      <div class="d-flex">
        <a href="{{ url_for('index') }}" class="btn btn-outline-warning">Cart</a>
      </div>
    </div>
  </nav>
  <h1 class="mb-4">Completed Orders</h1>

  {% if completed %}
    <div class="completed-orders mb-4">
      <ul class="list-group">
        {% for order in completed %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <strong>{{ order.customer_name }}'s {{ order.drink }}</strong> ({{ order.size }}, {{ order.milk }}, {{ order.temperature }})
              {% if order.extra_shot %}
                <br><small class="text-muted">+ Extra Shot</small>
              {% endif %}
              {% if order.notes %}
                <br><small class="text-muted">Note: {{ order.notes }}</small>
              {% endif %}
              <br><small class="fw-bold">Price: ${{ "%.2f"|format(order.price) }}</small>
            </div>
            <form action="{{ url_for('delete_order', order_id=order.id) }}" method="post" style="margin: 0;">
              <button class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this order?')">Delete</button>
            </form>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% else %}
    <p>No completed orders yet.</p>
  {% endif %}

<div class="summary mb-4">
  <h4 class="mb-3">Summary</h4>
  <div class="row">
    <div class="col-md-6">
      <ul class="list-group">
        <li class="list-group-item d-flex justify-content-between">
          <span>Total Drinks Made:</span> <strong>{{ total_drinks }}</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Total Lattes:</span> <strong>{{ total_lattes }}</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Total Coffees:</span> <strong>{{ total_coffees }}</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Total Money Made:</span> <strong>${{ "%.2f"|format(total_money) }}</strong>
        </li>
      </ul>
    </div>
    <div class="col-md-6">
      <canvas id="summaryChart" height="200"></canvas>
    </div>
  </div>
</div>

  <form action="{{ url_for('export_completed_csv') }}" method="get">
    <button type="submit" class="btn btn-outline-primary">Export to CSV</button>
  </form>

<script>
    const ctx = document.getElementById('summaryChart').getContext('2d');
    const summaryChart = new Chart(ctx, {
        type: 'bar',
        data: {
        labels: ['Lattes', 'Coffees'],
        datasets: [{
            label: 'Drinks Made',
            data: [{{ total_lattes | tojson }}, {{ total_coffees | tojson }}],
            backgroundColor: ['#8e44ad', '#3498db'],
            borderRadius: 5
        }]
        },
        options: {
        responsive: true,
        plugins: {
            legend: {
            display: false
            },
            title: {
            display: true,
            text: 'Drinks Breakdown',
            font: {
                size: 16
            }
            }
        },
        scales: {
            y: {
            beginAtZero: true,
            ticks: {
                precision: 0
            }
            }
        }
        }
    });
  </script>
</body>
</html>
